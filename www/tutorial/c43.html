<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Acquiring images (Quickstart guide)</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="libcam Tutorial"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="License"
HREF="x39.html"><LINK
REL="NEXT"
TITLE="Using a CamUnitChain"
HREF="x65.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>libcam Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x39.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x65.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="ch-acquiring"
></A
>Chapter 1. Acquiring images (Quickstart guide)</H1
><P
>&#13;    The fundamental class in libcam is the <CODE
CLASS="classname"
>CamUnit</CODE
> class.
    Conceptually, an instance of a <CODE
CLASS="classname"
>CamUnit</CODE
> represents an
    object that can produce frames.  Units are typically connected in series,
    or in a tree-like fashion, to form an image processing application.
    Because units connected in series are very common, libcam provides the
    convenience class <CODE
CLASS="classname"
>CamUnitChain</CODE
> for managing units.
</P
><P
>&#13;    <A
HREF="c43.html#trivial-acquire.c"
>Example 1-1</A
> provides a basic example on how to
    acquire a test image and write it to disk.  It uses the builtin
    <TT
CLASS="literal"
>input.example</TT
> CamUnit, which periodically generates a
    test image.  
</P
><DIV
CLASS="example"
><A
NAME="trivial-acquire.c"
></A
><P
><B
>Example 1-1. Basic Image Acquisition</B
></P
><PRE
CLASS="programlisting"
>&#13;
#include &#60;stdio.h&#62;

#include &#60;glib.h&#62;
#include &#60;libcam/cam.h&#62;

static void on_frame_ready (CamUnitChain *chain, CamUnit *unit, 
        const CamFrameBuffer *buf, void *user_data)
{
    GMainLoop *mainloop = (GMainLoop*) user_data;
    const CamUnitFormat *fmt = cam_unit_get_output_format (unit);
    FILE *fp = fopen ("trivial-acquire.ppm", "wb");
    if (fp) {
        fprintf(fp, "P6 %d %d %d\n", fmt-&#62;width, fmt-&#62;height, 255);
        for (int i=0; i&#60;fmt-&#62;height; i++){
            int count = fwrite(buf-&#62;data + i*fmt-&#62;row_stride, 
                    fmt-&#62;width*3, 1, fp);
            if (1 != count) {
                perror ("fwrite");
                break;
            }
        }
        fclose (fp);
    }
    printf ("wrote to trivial-acquire.ppm\n");
    g_main_quit (mainloop);
}

int main(int argc, char **argv)
{
    g_type_init();

    // create the GLib event handling loop
    GMainLoop *mainloop = g_main_loop_new (NULL, FALSE);

    // create an image processing chain and add a single example unit
    CamUnitChain * chain = cam_unit_chain_new ();
    cam_unit_chain_add_unit_by_id (chain, "input.example");

    // start the chain streaming
    cam_unit_chain_set_desired_status (chain, CAM_UNIT_STATUS_STREAMING);

    // attach the chain to the glib event loop.
    cam_unit_chain_attach_glib (chain, G_PRIORITY_DEFAULT, NULL);

    // subscribe to be notified when an image has made its way through the
    // chain
    g_signal_connect (G_OBJECT (chain), "frame-ready",
            G_CALLBACK (on_frame_ready), mainloop);

    // run 
    g_main_loop_run (mainloop);

    // cleanup
    g_main_loop_unref (mainloop);
    g_object_unref (chain);
    return 0;
}

</PRE
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="acquiring-glib"
>1.1. Using libcam with GLib</A
></H1
><P
>&#13;        libcam uses the <CODE
CLASS="classname"
>GObject</CODE
> type
        system, which must be initialized before any libcam classes are
        instantiated.
        <PRE
CLASS="programlisting"
>&#13;    g_type_init ();
        </PRE
>

        libcam was designed for easy integration into a GLib event loop.
        While libcam does not require the GLib event loop, and can be used
        with other event loops such as Qt, libcam does provide convenience
        functions for working with the GLib mainloop, and the tutorials all
        assume the use of a <CODE
CLASS="classname"
>GMainLoop</CODE
>.  To create a
        <CODE
CLASS="classname"
>GMainLoop</CODE
>, use
        <CODE
CLASS="function"
>g_main_loop_new</CODE
>.
        <PRE
CLASS="programlisting"
>&#13;    GMainLoop * mainloop = g_main_loop_new (NULL, FALSE);
        </PRE
>
        
    </P
><P
>&#13;        For more details on event driven programming with GLib, see the GLib
        documentation and tutorials.
    </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x39.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x65.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>License</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Using a <CODE
CLASS="classname"
>CamUnitChain</CODE
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>